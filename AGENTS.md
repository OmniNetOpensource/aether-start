# Repository Guidelines

## Project Structure & Module Organization
- `src/routes/` contains TanStack Start file-based routes (UI pages and API handlers). Dynamic segments use `$` (example: `src/routes/app/c/$conversationId.tsx`).
- `src/routeTree.gen.ts` is auto-generated by TanStack Router; do not edit it manually.
- Core business modules live in `src/features/` (chat, conversation, sidebar, theme, responsive).
- Shared UI and utilities live in `src/shared/` (`src/shared/ui/`, `src/shared/components/`, `src/shared/lib/`, `src/shared/hooks/`, `src/shared/stores/`).
- Server-only helpers live in `src/server/`; database migrations are in `migrations/`; deploy scripts are in `scripts/`.
- Static assets go in `public/`.

## Build, Test, and Development Commands
Use `pnpm` for all tasks.
- `pnpm install` - Install dependencies
- `pnpm dev` - Start local dev server on port 3000
- `pnpm build` - Build production bundle
- `pnpm check` - Run type-check, lint, and build together
- `pnpm cf:typegen` - Regenerate Cloudflare worker bindings types
- `pnpm cf:migrate:local` - Apply D1 migrations locally
- `pnpm cf:migrate:remote` - Apply D1 migrations remotely
- `pnpm cf:deploy` - Build and deploy to Cloudflare Workers


## Coding Style & Naming Conventions
- TypeScript + React; follow existing patterns (2-space indent, single quotes, no semicolons).
- Components use PascalCase (`MessageList.tsx`), hooks use `useX` naming, and stores use `*Store`.
- Route file names mirror paths (e.g., `index.tsx`, `__root.tsx`, `$param.tsx`).
- Keep changes ESLint-clean; lint rules live in `eslint.config.mjs`.

## Configuration & Secrets
- Local secrets live in `.env.local` (for example: `ANTHROPIC_API_KEY`, `ANTHROPIC_BASE_URL`, `SERP_API_KEY`, `JINA_API_KEY`, `SUPADATA_API_KEY`).
- Cloudflare bindings are configured in `wrangler.jsonc` (`DB` for D1, `CHAT_ASSETS` for R2).
- Never commit real secrets; `NEXT_PUBLIC_*` values are exposed to the client.

## Commit & Pull Request Guidelines
- Commit messages are short and imperative; optional conventional prefixes like `feat:` or `fix:` appear in history.
- PRs should include: a clear summary, validation notes (`pnpm check`), and screenshots for UI changes.
- Link relevant issues and call out any config or env changes.



# IMPORTANT， USER PREFERENCE

- 没有我的同意，不允许revert changes

- commit的时候，先pnpm check（如果这个命令的报错不是你造成的，不必理会）并review，然后只commit自己修改的部分，不是你自己修改的diff你不要管不要理会也不要动。commit之后不着急push。

- 修改之前，你必须要通过问问题得到我的确认
